(window.webpackJsonpvs=window.webpackJsonpvs||[]).push([[0],{128:function(e,t,a){e.exports=a(243)},133:function(e,t,a){},238:function(e,t,a){},243:function(e,t,a){"use strict";a.r(t);var n=a(1),l=a.n(n),o=a(45),r=a.n(o),s=(a(133),a(267)),c=a(124),i=a(273),u=a(268),m=a(270),d=a(269),h=a(125),p=a.n(h),g=a(271),f=a(19),v=a(12),E=a(20),b=a(21),y=a(23),w=a(118),O=a.n(w);function S(e){var t=0,a=0,n=0,l=0;e.setup=function(){t=window.innerWidth-30<536?window.innerWidth-30:536,a=t,e.createCanvas(t,t,e.WEBGL),e.background(4)},e.myCustomRedrawAccordingToNewPropsHandler=function(t){e.sendDragged=t.sendDragged,t.rx==n&&t.ry==l||(n=t.rx,l=t.ry)},e.mouseDragged=function(t){e.noStroke(),e.ellipse(e.mouseX,e.mouseY,2),e.sendDragged(e.mouseX,e.mouseY)};e.draw=function(){e.noStroke(),e.translate(-t/2,-a/2),e.ellipse(n,l,2),1,e.rect(5,10,1,1)}}var C=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(E.a)(this,Object(b.a)(t).call(this,e))).state={x:0,y:0},a}return Object(y.a)(t,e),Object(v.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.dataChannel.addEventListener("message",(function(t){e.setState(JSON.parse(t.data))}))}},{key:"render",value:function(){var e=this;return l.a.createElement("div",null,l.a.createElement("br",null),JSON.stringify(this.state),l.a.createElement(O.a,{sketch:S,rx:this.state.x,ry:this.state.y,sendDragged:function(t,a){e.props.dataChannel.send(JSON.stringify({x:t,y:a}))}}),"Latency Test 1")}}]),t}(n.Component),k=a(38),j=a(39),D=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(E.a)(this,Object(b.a)(t).call(this,e))).state={ping:0,lats:[]},a}return Object(y.a)(t,e),Object(v.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.dataChannel.addEventListener("message",(function(t){console.log(t.data),"PONG"==t.data&&(console.log("PONG",(new Date).getTime()-e.state.ping),e.setState({lats:e.state.lats.concat([(new Date).getTime()-e.state.ping])})),"PING"==t.data&&e.props.dataChannel.send("PONG")})),setInterval((function(){var t=(new Date).getTime();e.setState({ping:t}),e.props.dataChannel.send("PING")}),2e3)}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("p",null,"Min: ",Math.min.apply(Math,Object(k.a)(this.state.lats))," ms"),l.a.createElement("p",null,"Average:"," ",Math.round(this.state.lats.reduce((function(e,t){return t+e}),0)/this.state.lats.length)," ms"),l.a.createElement("p",null,"Max: ",Math.max.apply(Math,Object(k.a)(this.state.lats))," ms"),l.a.createElement(j.e,{height:300,width:300},l.a.createElement(j.c,null),l.a.createElement(j.a,null),l.a.createElement(j.d,null),l.a.createElement(j.f,null),l.a.createElement(j.b,{animation:!0,data:this.state.lats.map((function(e,t){return{x:t,y:e}}))})))}}]),t}(n.Component),x=a(59),N=a.n(x),T={apiKey:"AIzaSyDGBsWu_dwvGW3TGXZswEMR4X2PNhStaA4",authDomain:"solar-sailer.firebaseapp.com",databaseURL:"https://solar-sailer.firebaseio.com",projectId:"solar-sailer",storageBucket:"solar-sailer.appspot.com",messagingSenderId:"23628532125",appId:"1:23628532125:web:f48762f23514163d940774"},I=N.a.initializeApp(T).firestore(),M=function(e,t){I.collection("live").doc(t).set({guestSdp:e,guestJoinTs:N.a.firestore.FieldValue.serverTimestamp()},{merge:!0}).then((function(){console.log("guestSdp successfully written!")})).catch((function(e){console.error("Error writing document: ",e)}))},R=a(57),G=a.n(R),W=a(121),B=a.n(W),F=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(E.a)(this,Object(b.a)(t).call(this))).handleChange=function(t){e.setState({roomcode:t.target.value.toUpperCase()})},e.listenToRoom=function(t){I.collection("live").doc(t).onSnapshot((function(a){console.log("Current data ",a.data());var n=a.data();(console.log(n),n&&"hostSdp"in n&&!("guestSdp"in n))&&G()("solarsailer",{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:stun.voxgratia.org"}]}).consumeOffer(n.hostSdp,(function(a,n){M(n.sdp,t),console.log("consumeResult",a,n),n.getOpenDataChannel((function(t,a){console.log(t,a),e.props.saveDataChannel(a)}))}))}))},e.handleClick=function(t){e.setState({loading:!0}),e.listenToRoom(t.toUpperCase())},e.state={loading:!1,roomcode:""},e}return Object(y.a)(t,e),Object(v.a)(t,[{key:"componentDidMount",value:function(){console.log(this.props.match),this.props.match&&this.props.match.length>0&&this.listenToRoom(this.props.match)}},{key:"render",value:function(){return l.a.createElement("div",null,!this.props.noInputs&&l.a.createElement(l.a.Fragment,null,l.a.createElement(B.a,{length:6,initialValue:"",style:{padding:"10px"},inputStyle:{border:"none",borderBottom:"1px solid black"},inputFocusStyle:{borderColor:"blue"},onComplete:this.handleClick}),this.state.loading&&"linking..."))}}]),t}(n.Component),J=a(122),L=a.n(J),P=a(272),A=a(266),K=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(E.a)(this,Object(b.a)(t).call(this,e))).rtcOffer=null,a.state={sdp:null,dataChannel:null,offerResult:null,roomkey:null,tab:0},a}return Object(y.a)(t,e),Object(v.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=localStorage.getItem("link_2.roomkey");t=t||(""+Math.random()).substring(2,8),localStorage.getItem("link_2.roomkey")||localStorage.setItem("link_2.roomkey",t);var a,n,l=G()("solarsailer",{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:stun.voxgratia.org"}]});null==this.state.sdp&&l.createOffer({ordered:!1},(function(a,n){var l,o;console.log(n.sdp),l=n.sdp,o=t,I.collection("live").doc(o).set({hostSdp:l,hostJoinTs:N.a.firestore.FieldValue.serverTimestamp()}).then((function(){console.log("hostSdp successfully written!")})).catch((function(e){console.error("Error writing document: ",e)})),e.setState({sdp:n.sdp,offerResult:n,roomKey:t})})),a=t,n=function(t){var a=t.data();a&&"guestSdp"in a&&(console.log(a.guestSdp),e.state.offerResult&&e.state.offerResult.answer(a.guestSdp,(function(t,a){console.log("answerResult",t,a),a&&a.getOpenDataChannel((function(t,a){console.log("in producer data channel"),console.log(t,a),a.send("hello"),e.setState({dataChannel:a})}))})))},I.collection("live").doc(a).onSnapshot(n)}},{key:"render",value:function(){var e=this,t=this.props.match.params.roomid,a=this.props.location.pathname.split("/")[1],n="".concat(window.location.origin,"/#").concat(a,"/").concat(this.state.roomKey);return l.a.createElement(l.a.Fragment,null,null==this.state.dataChannel&&l.a.createElement("div",{style:{textAlign:"center"}},l.a.createElement(P.a,{value:this.state.tab,onChange:function(t,a){return e.setState({tab:a})},indicatorColor:"primary",textColor:"primary",centered:!0},l.a.createElement(A.a,{label:"Host"}),l.a.createElement(A.a,{label:"Join"})),0==this.state.tab&&l.a.createElement(l.a.Fragment,null,l.a.createElement("br",null),t?l.a.createElement(F,{match:t,noInputs:!0,sdp:this.state.sdp,saveDataChannel:function(t){e.setState({dataChannel:t})}}):l.a.createElement("div",null,l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("tt",{style:{fontSize:38,letterSpacing:16}},this.state.roomKey),l.a.createElement("br",null),l.a.createElement("br",null),this.state.roomKey&&l.a.createElement("div",null,l.a.createElement(L.a,{value:n}),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("tt",null,n)))),1==this.state.tab&&l.a.createElement(F,{match:t,sdp:this.state.sdp,saveDataChannel:function(t){e.setState({dataChannel:t})}})),this.state.dataChannel&&l.a.createElement(l.a.Fragment,null,"draw"==a&&l.a.createElement(C,{dataChannel:this.state.dataChannel}),"latte"==a&&l.a.createElement(D,{dataChannel:this.state.dataChannel})))}}]),t}(n.Component),X=a(37),_=a(30),z=(a(238),a(239),function(e){function t(){return Object(f.a)(this,t),Object(E.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("h2",null,"Welcome to The Link"),l.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light"},l.a.createElement("ul",{className:"navbar-nav mr-auto"},l.a.createElement("li",null,l.a.createElement(X.b,{to:"/draw",className:"nav-link"},"Draw Demo")),l.a.createElement("li",null,l.a.createElement(X.b,{to:"/latte",className:"nav-link"},"Latency tester")))))}}]),t}(n.Component)),U=Object(c.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));var V=function(){var e=U();return l.a.createElement(l.a.Fragment,null,l.a.createElement(s.a,null),l.a.createElement(i.a,{position:"static"},l.a.createElement(u.a,null,l.a.createElement(d.a,{edge:"start",className:e.menuButton,color:"inherit","aria-label":"menu"},l.a.createElement(p.a,null)),l.a.createElement(m.a,{variant:"h6",className:e.title},l.a.createElement("a",{href:"/",className:"nav-link nonlink"},"The Link")))),l.a.createElement(g.a,{maxWidth:"sm"},l.a.createElement(X.a,null,l.a.createElement("div",null,l.a.createElement(_.c,null,l.a.createElement(_.a,{path:"//",component:z}),l.a.createElement(_.a,{path:"/draw/:roomid",component:K}),l.a.createElement(_.a,{path:"/draw",component:K}),l.a.createElement(_.a,{path:"/latte/:roomid",component:K}),l.a.createElement(_.a,{path:"/latte",component:K}))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(l.a.createElement(X.a,null,l.a.createElement(V,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[128,1,2]]]);
//# sourceMappingURL=main.840c9a81.chunk.js.map