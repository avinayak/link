(window.webpackJsonpvs=window.webpackJsonpvs||[]).push([[0],{133:function(e,t,n){e.exports=n(248)},138:function(e,t,n){},243:function(e,t,n){},248:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),r=n(45),l=n.n(r),s=(n(138),n(273)),i=n(127),c=n(279),u=n(274),m=n(276),d=n(275),h=n(128),p=n.n(h),f=n(14),g=n(11),v=n(15),y=n(16),E=n(17),b=n(57),x=n.n(b);function w(e){var t=0,n=0,a=0,o=0;e.setup=function(){t=window.innerWidth-30<536?window.innerWidth-30:536,n=t,e.createCanvas(t,t,e.WEBGL),e.background(4)},e.myCustomRedrawAccordingToNewPropsHandler=function(t){e.sendDragged=t.sendDragged,t.rx==a&&t.ry==o||(a=t.rx,o=t.ry)},e.mouseDragged=function(t){e.noStroke(),e.ellipse(e.mouseX,e.mouseY,2),e.sendDragged(e.mouseX,e.mouseY)};e.draw=function(){e.noStroke(),e.translate(-t/2,-n/2),e.ellipse(a,o,2),1,e.rect(5,10,1,1)}}var k=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(y.a)(t).call(this,e))).state={x:0,y:0},n}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.dataChannel.addEventListener("message",(function(t){e.setState(JSON.parse(t.data))}))}},{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("br",null),JSON.stringify(this.state),o.a.createElement(x.a,{sketch:w,rx:this.state.x,ry:this.state.y,sendDragged:function(t,n){e.props.dataChannel.send(JSON.stringify({x:t,y:n}))}}),"Latency Test 1")}}]),t}(a.Component),C=n(38),O=n(39),S=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(y.a)(t).call(this,e))).state={ping:0,lats:[]},n}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.dataChannel.addEventListener("message",(function(t){console.log(t.data),"PONG"==t.data&&(console.log("PONG",(new Date).getTime()-e.state.ping),e.setState({lats:e.state.lats.concat([(new Date).getTime()-e.state.ping])})),"PING"==t.data&&e.props.dataChannel.send("PONG")})),setInterval((function(){var t=(new Date).getTime();e.setState({ping:t}),e.props.dataChannel.send("PING")}),2e3)}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("p",null,"Min: ",Math.min.apply(Math,Object(C.a)(this.state.lats))," ms"),o.a.createElement("p",null,"Average:"," ",Math.round(this.state.lats.reduce((function(e,t){return t+e}),0)/this.state.lats.length)," ms"),o.a.createElement("p",null,"Max: ",Math.max.apply(Math,Object(C.a)(this.state.lats))," ms"),o.a.createElement(O.e,{height:300,width:300},o.a.createElement(O.c,null),o.a.createElement(O.a,null),o.a.createElement(O.d,null),o.a.createElement(O.f,null),o.a.createElement(O.b,{animation:!0,data:this.state.lats.map((function(e,t){return{x:t,y:e}}))})))}}]),t}(a.Component),j=n(62),M=n.n(j),D={apiKey:"AIzaSyDGBsWu_dwvGW3TGXZswEMR4X2PNhStaA4",authDomain:"solar-sailer.firebaseapp.com",databaseURL:"https://solar-sailer.firebaseio.com",projectId:"solar-sailer",storageBucket:"solar-sailer.appspot.com",messagingSenderId:"23628532125",appId:"1:23628532125:web:f48762f23514163d940774"},N=M.a.initializeApp(D).firestore(),I=function(e,t){N.collection("live").doc(t).set({guestSdp:e,guestJoinTs:M.a.firestore.FieldValue.serverTimestamp()},{merge:!0}).then((function(){console.log("guestSdp successfully written!")})).catch((function(e){console.error("Error writing document: ",e)}))},R=n(58),T=n.n(R),W=n(124),K=n.n(W),G=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(v.a)(this,Object(y.a)(t).call(this))).handleChange=function(t){e.setState({roomcode:t.target.value.toUpperCase()})},e.listenToRoom=function(t){N.collection("live").doc(t).onSnapshot((function(n){console.log("Current data ",n.data());var a=n.data();(console.log(a),a&&"hostSdp"in a&&!("guestSdp"in a))&&T()("solarsailer",{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:stun.voxgratia.org"}]}).consumeOffer(a.hostSdp,(function(n,a){I(a.sdp,t),console.log("consumeResult",n,a),a.getOpenDataChannel((function(t,n){console.log(t,n),e.props.saveDataChannel(n)}))}))}))},e.handleClick=function(t){e.setState({loading:!0}),e.listenToRoom(t.toUpperCase())},e.state={loading:!1,roomcode:""},e}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){console.log(this.props.match),this.props.match&&this.props.match.length>0&&this.listenToRoom(this.props.match)}},{key:"render",value:function(){return o.a.createElement("div",null,this.props.noInputs?"linking...":o.a.createElement(o.a.Fragment,null,o.a.createElement(K.a,{length:6,initialValue:"",style:{padding:"10px"},inputStyle:{border:"none",borderBottom:"1px solid black"},inputFocusStyle:{borderColor:"blue"},onComplete:this.handleClick}),this.state.loading&&"linking..."))}}]),t}(a.Component),A=n(125),B=n.n(A),J=n(278),L=n(271),X=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(y.a)(t).call(this,e))).sendMove=function(e){var t={payload:e,from:n.props.roomKey,type:"data"};console.log("sending",t),n.props.dataChannel.send(JSON.stringify(t)),n.setState({turn:!n.state.turn})},n.sketch=function(e){var t=e.windowWidth,n=e.windowWidth<e.windowHeight?(t-20)/7:t/3/7,a=0,o=0,r=["#00CBC4","#2980b9"],l=.3*n,s=e.windowWidth<e.windowHeight?10:(t-7*n)/2,i=10*n+10,c=.2*n,u=[],m=-1,d=-1,h=function(e){return 0!=e.x&&6!=e.x||0!=e.y&&9!=e.y?0==e.x||6==e.x||0==e.y||9==e.y?3:4:2},p=function(e){var t={x:10,y:10},a=u[e.y][e.x].length;return 0==a?t={x:-c,y:c}:1==a?t={x:-c,y:-c}:2==a?t={x:c,y:-c}:3==a&&(t={x:c,y:c}),{x:e.x*n+n/2+s+t.x,y:e.y*n+n/2+10+t.y}},f=function(e){return e.x>=0&&e.x<7&&e.y>=0&&e.y<10},g=function(e){return!!f(e)&&(0==u[e.y][e.x].length||u[e.y][e.x][0].color==a)};e.setup=function(){e.createCanvas(t,i,e.WEBGL),function(){for(var e=0;e<10;e++){u[e]=new Array(7);for(var t=0;t<7;t++)u[e][t]=[]}}()};var v=function(){for(var e=0;e<10;e++)for(var t=0;t<7;t++)for(var n=0;n<u[e][t].length;n++)if(u[e][t][n].inMovment)return!0;return!1},y=function(e){[{x:e.x-1,y:e.y},{x:e.x+1,y:e.y},{x:e.x,y:e.y-1},{x:e.x,y:e.y+1}].forEach((function(t){if(f(t)&&u[e.y][e.x].length>0){var n=u[e.y][e.x].pop(),a=p(t);n.move(a.x,a.y),function(e,t){for(var n=u[e.y][e.x],a=0;a<n.length;a++)n[a].robotId!=t.robotId&&(n[a].robotId=t.robotId,n[a].color=t.color);for(n.push(t);h(e)<n.length;)n.pop()}(t,n)}}))},E=function(t){var n=p(t);u[t.y][t.x].push(function(t,n,a){var o={inMovment:!1};return o.x=t,o.y=n,o.robotId=Math.random().toString(36).substring(7),o.destinationX=t,o.destinationY=n,o.color=a,o.show=function(){e.noStroke(),e.fill(r[o.color]),e.ellipse(o.x,o.y,l)},o.move=function(e,t){o.inMovment||(o.destinationX=e,o.destinationY=t)},o.update=function(e,t){o.x+=.4*(o.destinationX-o.x),o.y+=.4*(o.destinationY-o.y),o.inMovment=!(o.x-o.destinationX<.1&&o.y-o.destinationY<.1)},o}(n.x,n.y,a)),a=(a+1)%2,b()},b=function(){(function(){for(var e=[],t=null,n=0;n<10;n++)for(var a=0;a<7;a++)t={x:a,y:n},u[n][a].length==h(t)&&e.push(t);return e})().forEach((function(e){y(e)}))};e.mouseClicked=function(){var t,a,r=(t=e.mouseX,a=e.mouseY,{x:Math.floor((t-s)/n),y:Math.floor((a-10)/n)});g(r)&&!v()&&o&&(E(r),e.sendMove(r),m=-1,d=-1)},e.draw=function(){e.smooth(),e.strokeWeight(.6),e.translate(-t/2,-i/2),e.background("#34495e"),e.stroke(255,255,255,10),function(){for(var t=0;t<8;t++)e.line(s+t*n,10,s+t*n,10+10*n);for(var a=0;a<11;a++)e.line(s,10+a*n,s+7*n,10+a*n)}();for(var a=0;a<10;a++)for(var o=0;o<7;o++)u[a][o]&&u[a][o].forEach((function(e){e.update(),e.show()}));v()||b()},e.myCustomRedrawAccordingToNewPropsHandler=function(t){e.sendMove=t.sendMove,o=t.turn?1:0,t.opx==m&&t.opy==d||(m=t.opx,d=t.opy,console.log({x:m,y:d},"-------------"),g({x:m,y:d})&&!v()&&E({x:m,y:d}))}},n.state={x:-1,y:-1,turn:!n.props.host},n}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.dataChannel.addEventListener("message",(function(t){var n=JSON.parse(t.data);n.from!==e.props.roomKey&&(console.log("received",n),e.setState({turn:!e.state.turn,x:n.payload.x,y:n.payload.y}))}))}},{key:"render",value:function(){return o.a.createElement("div",{style:{height:window.innerHeight-56,background:"#34495e"}},o.a.createElement(x.a,{sketch:this.sketch,turn:this.state.turn,sendMove:this.sendMove,opx:this.state.x,opy:this.state.y}),o.a.createElement("div",{style:{textAlign:"center",color:"white"}},this.state.turn?o.a.createElement("tt",{style:{fontSize:18},className:"blink_me"},"Your turn"):o.a.createElement("small",null,"Waiting for opponent to move")))}}]),t}(a.Component),F=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(y.a)(t).call(this,e))).rtcOffer=null,n.state={host:!0,sdp:null,dataChannel:null,offerResult:null,roomkey:null,tab:0},n}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=localStorage.getItem("link_2.roomkey");t=t||(""+Math.random()).substring(2,8),localStorage.getItem("link_2.roomkey")||localStorage.setItem("link_2.roomkey",t);var n,a,o=T()("solarsailer",{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:stun.voxgratia.org"}]});null==this.state.sdp&&o.createOffer({ordered:!1},(function(n,a){var o,r;console.log(a.sdp),o=a.sdp,r=t,N.collection("live").doc(r).set({hostSdp:o,hostJoinTs:M.a.firestore.FieldValue.serverTimestamp()}).then((function(){console.log("hostSdp successfully written!")})).catch((function(e){console.error("Error writing document: ",e)})),e.setState({sdp:a.sdp,offerResult:a,roomKey:t})})),n=t,a=function(t){var n=t.data();n&&"guestSdp"in n&&(console.log(n.guestSdp),e.state.offerResult&&e.state.offerResult.answer(n.guestSdp,(function(t,n){console.log("answerResult",t,n),n&&n.getOpenDataChannel((function(t,n){console.log("in producer data channel"),console.log(t,n),n.send("hello"),e.setState({dataChannel:n})}))})))},N.collection("live").doc(n).onSnapshot(a)}},{key:"render",value:function(){var e=this,t=this.props.match.params.roomid,n=this.props.location.pathname.split("/")[1],a="".concat(window.location.href.split("#")[0],"#").concat(n,"/").concat(this.state.roomKey);return o.a.createElement(o.a.Fragment,null,null==this.state.dataChannel&&o.a.createElement("div",{style:{textAlign:"center"}},o.a.createElement(J.a,{value:this.state.tab,onChange:function(t,n){return e.setState({tab:n})},indicatorColor:"primary",textColor:"primary",centered:!0},o.a.createElement(L.a,{label:"Host"}),o.a.createElement(L.a,{label:"Join"})),o.a.createElement("div",{style:{textAlign:"center"}},o.a.createElement("br",null),null==this.state.sdp&&"generating id.."),0==this.state.tab&&o.a.createElement(o.a.Fragment,null,o.a.createElement("br",null),t?o.a.createElement(G,{match:t,noInputs:!0,sdp:this.state.sdp,saveDataChannel:function(t){e.setState({dataChannel:t,host:!1})}}):o.a.createElement("div",null,o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("tt",{style:{fontSize:38,letterSpacing:16}},this.state.roomKey),o.a.createElement("br",null),o.a.createElement("br",null),this.state.roomKey&&o.a.createElement("div",null,o.a.createElement(B.a,{value:a}),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("tt",null,a)))),1==this.state.tab&&o.a.createElement(G,{match:t,sdp:this.state.sdp,saveDataChannel:function(t){e.setState({dataChannel:t,host:!1})}})),this.state.dataChannel&&o.a.createElement(o.a.Fragment,null,"draw"==n&&o.a.createElement(k,{roomKey:this.state.roomKey,host:this.state.host,dataChannel:this.state.dataChannel}),"latte"==n&&o.a.createElement(S,{roomKey:this.state.roomKey,host:this.state.host,dataChannel:this.state.dataChannel}),"robots"==n&&o.a.createElement(X,{roomKey:this.state.roomKey,host:this.state.host,dataChannel:this.state.dataChannel})))}}]),t}(a.Component),P=n(31),Y=n(32),H=(n(243),n(244),n(272)),_=function(e){function t(){return Object(f.a)(this,t),Object(v.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return o.a.createElement(H.a,{maxWidth:"sm"},o.a.createElement("h2",null,"Welcome to The Link"),o.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light"},o.a.createElement("ul",{className:"navbar-nav mr-auto"},o.a.createElement("li",null,o.a.createElement(P.b,{to:"/robots",className:"nav-link"},"Robots")),o.a.createElement("li",null,o.a.createElement(P.b,{to:"/draw",className:"nav-link"},"Draw Demo")),o.a.createElement("li",null,o.a.createElement(P.b,{to:"/latte",className:"nav-link"},"Latency tester")))))}}]),t}(a.Component),z=Object(i.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));var U=function(){var e=z();return o.a.createElement(o.a.Fragment,null,o.a.createElement(s.a,null),o.a.createElement(c.a,{position:"static"},o.a.createElement(u.a,null,o.a.createElement(d.a,{edge:"start",className:e.menuButton,color:"inherit","aria-label":"menu"},o.a.createElement(p.a,null)),o.a.createElement(m.a,{variant:"h6",className:e.title},o.a.createElement("a",{href:window.location.href.split("#")[0],className:"nav-link nonlink"},"Link")))),o.a.createElement(P.a,null,o.a.createElement("div",null,o.a.createElement(Y.c,null,o.a.createElement(Y.a,{path:"//",component:_}),o.a.createElement(Y.a,{path:"/robots/:roomid",component:F}),o.a.createElement(Y.a,{path:"/robots",component:F}),o.a.createElement(Y.a,{path:"/draw/:roomid",component:F}),o.a.createElement(Y.a,{path:"/draw",component:F}),o.a.createElement(Y.a,{path:"/latte/:roomid",component:F}),o.a.createElement(Y.a,{path:"/latte",component:F})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var V=n(129),Z=n(277),$=Object(V.a)({shadows:["none"],palette:{primary:{main:"#000000"}}});l.a.render(o.a.createElement(Z.a,{theme:$},o.a.createElement(P.a,null,o.a.createElement(U,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[133,1,2]]]);
//# sourceMappingURL=main.c005c4b3.chunk.js.map